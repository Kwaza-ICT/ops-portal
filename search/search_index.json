{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Developer Portal of Kwaza ICT","text":""},{"location":"#welcome","title":"Welcome","text":"<p>Welcome to the documentation home page of Kwaza ICT.</p>"},{"location":"ubuntu/","title":"Check version list from apt","text":"<pre><code>apt-cache policy curl\n</code></pre>"},{"location":"github/api/commits/","title":"Commits","text":""},{"location":"github/api/commits/#list-all-the-commits-from-a-repository","title":"List all the commits from a repository","text":"<pre><code>curl -L \\\n    -H \"Accept: application/vnd.github+json\" \\\n    -H \"Authorization: Bearer &lt;github-token&gt;\" \\\n    -H \"X-GitHub-Api-Version: 2022-11-28\" \\\n    https://api.github.com/repos/ORG/REPOSITORY/commits\n</code></pre>"},{"location":"github/api/releases/","title":"Releases","text":""},{"location":"github/api/releases/#list-all-the-releases-from-a-repository","title":"list all the releases from a repository","text":"<pre><code>curl -L \\\n    -H \"Accept: application/vnd.github+json\" \\\n    -H \"Authorization: Bearer &lt;github-token&gt;\" \\\n    -H \"X-GitHub-Api-Version: 2022-11-28\" \\\n    https://api.github.com/repos/ORG/REPOSITORY/releases\n</code></pre>"},{"location":"github/api/repository/","title":"Repository","text":""},{"location":"github/api/repository/#list-members-of-a-repository","title":"List members of a repository","text":"<pre><code>curl -L \\\n    -H \"Accept: application/vnd.github+json\" \\\n    -H \"Authorization: Bearer &lt;github-token&gt;\" \\\n    -H \"X-GitHub-Api-Version: 2022-11-28\" \\\n    https://api.github.com/repos/ORG/REPOSITORY/collaborators\n</code></pre>"},{"location":"github/api/repository/#delete-a-repository","title":"Delete a repository","text":"<pre><code>curl -L \\\n    -X DELETE \\\n    -H \"Accept: application/vnd.github+json\" \\\n    -H \"Authorization: Bearer &lt;github-token&gt;\" \\\n    -H \"X-GitHub-Api-Version: 2022-11-28\" \\\n    https://api.github.com/repos/ORG/REPOSITORY\n</code></pre>"},{"location":"github/api/runner-group/","title":"Runner group","text":""},{"location":"github/api/runner-group/#list-all-the-offline-runner-groups","title":"List all the offline runner groups","text":"<pre><code>curl -L \\\n-H \"Accept: application/vnd.github+json\" \\\n-H \"Authorization: Bearer &lt;github-token&gt;\" \\\n-H \"X-GitHub-Api-Version: 2022-11-28\" \\\nhttps://api.github.com/orgs/&lt;org-name&gt;/actions/runner-groups/&lt;runner-group-number&gt;/runners | jq '.runners | .[] | select(.status == \"offline\") | .id'\n</code></pre>"},{"location":"github/api/runner-group/#delete-a-runner-from-runner-group","title":"Delete a runner from runner group","text":"<pre><code>curl -L \\\n-X DELETE \\\n-H \"Accept: application/vnd.github+json\" \\\n-H \"Authorization: Bearer &lt;github-token&gt;\" \\\n-H \"X-GitHub-Api-Version: 2022-11-28\" \\\nhttps://api.github.com/orgs/&lt;org-name&gt;/actions/runner-groups/&lt;runner-group-number&gt;/runners/&lt;runner-id&gt;\n</code></pre>"},{"location":"github/api/teams/","title":"Teams","text":""},{"location":"github/api/teams/#list-the-repositories-of-a-specific-team","title":"List the repositories of a specific team","text":"<pre><code>curl -L \\\n    -H \"Accept: application/vnd.github+json\" \\\n    -H \"Authorization: Bearer &lt;github-token&gt;\" \\\n    -H \"X-GitHub-Api-Version: 2022-11-28\" \\\n    https://api.github.com/repos/ORG/REPOSITORY/teams\n</code></pre>"},{"location":"github/runners/bash/","title":"How to remove offline runners from a runner group","text":"<pre><code>#!/usr/bin/env bash\n\nresponse=$(curl -L \\\n  -H \"Accept: application/vnd.github+json\" \\\n  -H \"Authorization: Bearer &lt;your temp token&gt;\" \\\n  -H \"X-GitHub-Api-Version: 2022-11-28\" \\\n  https://api.github.com/orgs/&lt;org-name&gt;/actions/runner-groups/&lt;runner-group-id&gt;/runners | jq '.runners | .[] | select(.status == \"offline\") | .id')\n\n# Check if the response is not empty\nif [ -n \"$response\" ]; then\n    # Loop over each line of the response\n    while IFS= read -r line; do\n        # Process each line (replace this with your own logic)\n        echo \"Received: $line\"\n        curl -L \\\n          -X DELETE \\\n          -H \"Accept: application/vnd.github+json\" \\\n          -H \"Authorization: Bearer &lt;your temp token&gt;\" \\\n          -H \"X-GitHub-Api-Version: 2022-11-28\" \\\n          https://api.github.com/orgs/&lt;org-name&gt;/actions/runner-groups/&lt;runner-group-id&gt;/runners/$line\n    done &lt;&lt;&lt; \"$response\"\nelse\n    echo \"Empty response received.\"\nfi\n</code></pre>"},{"location":"gitlab/13-to-14/","title":"How to upgrade from 13 to 14","text":"<p>First, you have to check what is your minor version on 13, because I strongly recommend you go to the latest minor version of 13 before jump to 14</p>"},{"location":"gitlab/13-to-14/#note","title":"Note","text":"<p>If you are running GitLab on Ubuntu 16, then jumping from 13 to 14 will not be possible since GitLab does not provide such repository.</p>"},{"location":"gitlab/13-to-14/#about-migrate-to-hashed-storage","title":"About migrate to hashed storage","text":"<p>In GitLab 13.0, hashed storage is enabled by default and the legacy storage is deprecated. GitLab 14.0 eliminates support for legacy storage.</p>"},{"location":"gitlab/13-to-14/#list-projects-using-hashed-storage","title":"List projects using hashed storage","text":"<pre><code># Projects\nsudo gitlab-rake gitlab:storage:hashed_projects\nsudo gitlab-rake gitlab:storage:list_hashed_projects\n\n# Attachments\nsudo gitlab-rake gitlab:storage:hashed_attachments\nsudo gitlab-rake gitlab:storage:list_hashed_attachments\n</code></pre>"},{"location":"gitlab/13-to-14/#migrate-to-hashed-storage","title":"Migrate to hashed storage","text":"<pre><code>sudo gitlab-rake gitlab:storage:migrate_to_hashed\n</code></pre>"},{"location":"gitlab/13-to-14/#if-you-encounter-some-issues-running-the-migrate-to-hashed-command-then-a-workaround-is","title":"If you encounter some issues running the migrate to hashed command, then a workaround is","text":"<pre><code>wget -O /tmp/fix-legacy-hashed-storage-migration.rb https://gitlab.com/snippets/2039252/raw 2\ngitlab-rails runner /tmp/fix-legacy-hashed-storage-migration.rb\n</code></pre>"},{"location":"gitlab/13-to-14/#db-migration-is-required","title":"DB migration is required","text":"<p>You have to do the DB migration yourself in order to finish the upgrade process. Check the db migration</p>"},{"location":"gitlab/14-to-15/","title":"How to upgrade from 14 to 15","text":""},{"location":"gitlab/14-to-15/#note","title":"Note","text":"<p>Find where your version sits in the upgrade path:</p>"},{"location":"gitlab/14-to-15/#path-to-follow","title":"Path to follow","text":"<p>GitLab 14: 14.0.12 &gt; 14.3.6 &gt; 14.9.5 &gt; 14.10.5 &gt; 15.0.5</p>"},{"location":"gitlab/14-to-15/#upgrade-gitlab-to-1436","title":"Upgrade GitLab to 14.3.6","text":"<pre><code>sudo apt install gitlab-ce=14.3.6-ce.0\n</code></pre>"},{"location":"gitlab/14-to-15/#upgrade-gitlab-to-1495","title":"Upgrade GitLab to 14.9.5","text":"<pre><code>sudo apt install gitlab-ce=14.9.5-ce.0\n</code></pre>"},{"location":"gitlab/14-to-15/#check-if-db-migration-succeeds","title":"Check if DB migration succeeds","text":"<p><pre><code>sudo gitlab-rake db:migrate:status\n</code></pre> If all is up, then you are ready to go.</p>"},{"location":"gitlab/14-to-15/#check-gitlab-services-status","title":"check gitlab services status","text":"<pre><code>sudo gitlab-ctl status\n</code></pre> <p>If they are all running like this, then you are ready to go live <pre><code>run: alertmanager: (pid 15045) 88s; run: log: (pid 2411) 1127s\nrun: gitaly: (pid 15076) 87s; run: log: (pid 2398) 1127s\nrun: gitlab-exporter: (pid 15036) 89s; run: log: (pid 2410) 1127s\nrun: gitlab-kas: (pid 14996) 91s; run: log: (pid 14830) 163s\nrun: gitlab-pages: (pid 15017) 90s; run: log: (pid 2403) 1127s\nrun: gitlab-workhorse: (pid 15007) 90s; run: log: (pid 2393) 1127s\nrun: grafana: (pid 15063) 88s; run: log: (pid 2412) 1127s\nrun: logrotate: (pid 15088) 87s; run: log: (pid 2377) 1128s\nrun: nginx: (pid 15094) 87s; run: log: (pid 2394) 1127s\nrun: node-exporter: (pid 15102) 86s; run: log: (pid 2397) 1127s\nrun: postgres-exporter: (pid 15038) 88s; run: log: (pid 2401) 1127s\nrun: postgresql: (pid 2400) 1127s; run: log: (pid 2392) 1127s\nrun: prometheus: (pid 15187) 86s; run: log: (pid 2399) 1127s\nrun: puma: (pid 15197) 85s; run: log: (pid 2415) 1127s\nrun: redis: (pid 14610) 170s; run: log: (pid 2407) 1127s\nrun: redis-exporter: (pid 15203) 85s; run: log: (pid 2396) 1127s\nrun: registry: (pid 15027) 89s; run: log: (pid 2402) 1127s\nrun: sidekiq: (pid 15212) 85s; run: log: (pid 2395) 1127s\n</code></pre></p>"},{"location":"gitlab/14-to-15/#upgrade-gitlab-to-14105","title":"Upgrade GitLab to 14.10.5","text":"<pre><code>sudo apt install gitlab-ce=14.10.5-ce.0\n</code></pre>"},{"location":"gitlab/14-to-15/#check-if-db-migration-succeeds-on-14105","title":"Check if DB migration succeeds on 14.10.5","text":"<p><pre><code>sudo gitlab-rake db:migrate:status\n</code></pre> If all is up, then you are ready to go.</p>"},{"location":"gitlab/14-to-15/#upgrade-gitlab-to-1505","title":"Upgrade GitLab to 15.0.5","text":"<pre><code>sudo apt install gitlab-ce=15.0.5-ce.0\n</code></pre>"},{"location":"gitlab/14-to-15/#check-if-db-migration-succeeds-on-1505","title":"Check if DB migration succeeds on 15.0.5","text":"<p><pre><code>sudo gitlab-rake db:migrate:status\n</code></pre> If all is up, then you are ready to go.</p>"},{"location":"gitlab/14-to-15/#check-gitlab-services-status-on-1505","title":"check gitlab services status on 15.0.5","text":"<pre><code>sudo gitlab-ctl status\n</code></pre> <p>If does not start or you get a 408, then follow this process:</p>"},{"location":"gitlab/14-to-15/#edit-etcgitlabgitlabrb-and-add-the-following-line","title":"Edit /etc/gitlab/gitlab.rb and add the following line","text":"<pre><code>nginx['ssl_ciphers'] = \"ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:AES256-GCM-SHA384\"\n</code></pre>"},{"location":"gitlab/14-to-15/#reconfigure-gitlab","title":"Reconfigure GitLab","text":"<pre><code>sudo gitlab-ctl reconfigure\n</code></pre>"},{"location":"gitlab/15-to-16/","title":"How to upgrade from 15 to 16","text":"<p>GitLab 15: 15.0.5 &gt; 15.1.0 &gt; 15.2.0 &gt; 15.2.5 &gt; 15.4.6 &gt; 15.11.13 &gt; 16.0.0</p>"},{"location":"gitlab/15-to-16/#upgrade-gitlab-to-1510","title":"Upgrade GitLab to 15.1.0","text":"<pre><code>sudo apt install gitlab-ce=15.1.0-ce.0\n</code></pre>"},{"location":"gitlab/15-to-16/#you-have-to-restart-services","title":"You have to restart services","text":"<pre><code>sudo gitlab-ctl restart\n</code></pre>"},{"location":"gitlab/15-to-16/#upgrade-gitlab-to-1520","title":"Upgrade GitLab to 15.2.0","text":"<pre><code>sudo apt install gitlab-ce=15.2.0-ce.0\n</code></pre>"},{"location":"gitlab/15-to-16/#upgrade-gitlab-to-1525","title":"Upgrade GitLab to 15.2.5","text":"<pre><code>sudo apt install gitlab-ce=15.2.5-ce.0\n</code></pre>"},{"location":"gitlab/15-to-16/#upgrade-gitlab-to-1546","title":"Upgrade GitLab to 15.4.6","text":"<pre><code>sudo apt install gitlab-ce=15.4.6-ce.0\n</code></pre>"},{"location":"gitlab/15-to-16/#upgrade-gitlab-to-151113","title":"Upgrade GitLab to 15.11.13","text":"<pre><code>sudo apt install gitlab-ce=15.11.13-ce.0\n</code></pre>"},{"location":"gitlab/15-to-16/#upgrade-gitlab-to-1600","title":"Upgrade GitLab to 16.0.0","text":"<pre><code>sudo apt install gitlab-ce=16.0.0-ce.0\n</code></pre> <p>After upgrade to 16.0.0 I had this issue</p> <p></p> <p>In order to remove this error, let's upgrade to 16.0.8</p>"},{"location":"gitlab/15-to-16/#upgrade-gitlab-to-1608","title":"Upgrade GitLab to 16.0.8","text":"<pre><code>sudo apt install gitlab-ce=16.0.8-ce.0\n</code></pre>"},{"location":"gitlab/16-to-17/","title":"How to upgrade from 15 to 16","text":"<p>GitLab 16: 16.0.8 (only instances with lots of users or large pipeline variables history) &gt; 16.1.6 (instances with NPM packages in their package registry) &gt; 16.2.9 (only instances with large pipeline variables history) &gt; 16.3.7 &gt; 16.7.z &gt; latest 16.Y.Z.</p>"},{"location":"gitlab/db-migration/","title":"Run incomplete database migrations","text":"<p>Database migrations can be stuck in an incomplete state, with a down status in the output of the sudo gitlab-rake db:migrate:status command.</p>"},{"location":"gitlab/db-migration/#display-status-of-database-migrations","title":"Display status of database migrations","text":"<p>See the background migrations documentation for how to check that migrations are complete when upgrading GitLab. To check the status of specific migrations, you can use the following Rake task:</p> <pre><code>sudo gitlab-rake db:migrate:status\n</code></pre>"},{"location":"gitlab/db-migration/#to-complete-these-migrations-use-the-following-rake-task","title":"To complete these migrations, use the following Rake task","text":"<pre><code>sudo gitlab-rake db:migrate\n</code></pre> <p>After the migration is done, you should run the status again and be sure that they are all UP  If you encounter some issues while migrating, then I suggest you to read here and follow this process. Here is what I had to run in order to the db migrate finish properly.</p> <pre><code>sudo gitlab-rake gitlab:background_migrations:finalize[CopyColumnUsingBackgroundMigrationJob,ci_stages,id,'[[\"id\"]\\, [\"id_convert_to_bigint\"]]']\nsudo gitlab-rake gitlab:background_migrations:finalize[CopyColumnUsingBackgroundMigrationJob,ci_builds_metadata,id,'[[\"id\"]\\, [\"id_convert_to_bigint\"]]']\nsudo gitlab-rake gitlab:background_migrations:finalize[CopyColumnUsingBackgroundMigrationJob,ci_builds_metadata,id,'[[\"build_id\"]\\, [\"build_id_convert_to_bigint\"]]']\nsudo gitlab-rake gitlab:background_migrations:finalize[CopyColumnUsingBackgroundMigrationJob,push_event_payloads,event_id,'[[\"event_id\"]\\, [\"event_id_convert_to_bigint\"]]']\nsudo gitlab-rake gitlab:background_migrations:finalize[CopyColumnUsingBackgroundMigrationJob,deployments,id,'[[\"deployable_id\"]\\, [\"deployable_id_convert_to_bigint\"]]']\nsudo gitlab-rake gitlab:background_migrations:finalize[CopyColumnUsingBackgroundMigrationJob,taggings,id,'[[\"id\"\\, \"taggable_id\"]\\, [\"id_convert_to_bigint\"\\, \"taggable_id_convert_to_bigint\"]]']\n</code></pre>"},{"location":"gitlab/db-migration/#some-services-are-down","title":"Some services are down","text":"<p>If you see that some services are down, you can run</p> <pre><code>sudo gitlab-ctl restart\n</code></pre>"},{"location":"gitlab/upgrade-minor-version/","title":"How to do a minor upgrade","text":""},{"location":"gitlab/upgrade-minor-version/#how-to-add-gitlab-repository-into-ubuntu","title":"How to add Gitlab repository into ubuntu","text":"<pre><code>curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.deb.sh | sudo bash\n</code></pre>"},{"location":"gitlab/upgrade-minor-version/#check-status-of-all-services-gitlab","title":"Check status of all services gitlab","text":"<pre><code>sudo gitlab-ctl status\n</code></pre>"},{"location":"gitlab/upgrade-minor-version/#run-a-update-before-list-packages","title":"Run a update before list packages","text":"<pre><code>apt update\n</code></pre>"},{"location":"gitlab/upgrade-minor-version/#check-all-the-available-versions","title":"Check all the available versions","text":"<pre><code>apt list -a | grep gitlab-ce\n</code></pre>"},{"location":"gitlab/upgrade-minor-version/#check-version-available-for-upgrade","title":"Check version available for upgrade","text":"<pre><code>apt list --upgradable | grep gitlab\n</code></pre>"},{"location":"gitlab/upgrade-minor-version/#upgrade-to-specific-version-my-case-131215","title":"Upgrade to specific version (my case 13.12.15)","text":"<pre><code>apt install gitlab-ce=13.12.15-ce.0\n</code></pre>"},{"location":"k8s/delete-stuck-pod/","title":"Force a pod termination","text":""},{"location":"k8s/delete-stuck-pod/#delete-a-pod-when-is-stuck-in-a-terminating-state","title":"Delete a pod when is stuck in a terminating state","text":"<pre><code>#!/bin/bash\n\n# Get all pods in Terminating state and delete them\nterminating_pods=$(kubectl get pods | grep Terminating | awk '{print $1}')\n\nif [ -n \"$terminating_pods\" ]; then\n    echo \"Deleting Terminating pods: $terminating_pods\"\n    kubectl patch pod $terminating_pods -n actions-runner-system -p '{\"metadata\":{\"finalizers\":null}}'\nelse\n    echo \"No pods in Terminating state found.\"\nfi\n</code></pre>"},{"location":"k8s/pods/","title":"Pods commands and scripts","text":""},{"location":"k8s/pods/#restart-all-pods-from-a-specific-namespace","title":"Restart all pods from a specific namespace","text":"<pre><code>#!/bin/bash\n\n# Check if namespace argument is provided\nif [ $# -ne 1 ]; then\necho \"Usage: $0 &lt;namespace&gt;\"\nexit 1\nfi\n\nNAMESPACE=$1\n\n# Get all pod names within the specified namespace\nPOD_NAMES=$(kubectl get pods -n $NAMESPACE -o=jsonpath='{.items[*].metadata.name}')\n\n# Restart each pod\nfor POD_NAME in $POD_NAMES; do\necho \"Restarting pod: $POD_NAME\"\nkubectl delete pod $POD_NAME -n $NAMESPACE --grace-period=0 --force\ndone\n\necho \"All pods in namespace $NAMESPACE have been restarted.\"\n</code></pre>"},{"location":"k8s/pods/#download-the-script","title":"Download the script","text":"<p>restart-pods.sh</p>"},{"location":"linux/fstab/","title":"fstab","text":""},{"location":"linux/fstab/#mount-a-efs-when-machine-starts-using-fstab","title":"Mount a EFS when machine starts using fstab","text":"<pre><code>LABEL=cloudimg-rootfs   /    ext4   defaults,discard    0 1\nfs-123456.efs.eu-west-1.amazonaws.com:/ /mnt/efs nfs4 defaults,_netdev 0 0\n</code></pre>"},{"location":"redhat/subscription/","title":"Red Hat subscriptions","text":""},{"location":"redhat/subscription/#about","title":"About","text":"<p>subscription-manager is the command-line based client for the Red Hat Subscription Manager tool.</p> <p>The Subscription Manager performs several key operations:</p> <ul> <li>It registers machines to the Red Hat entitlement service and adds the machine to the systems inventory. Once a machine is registered, it can receive updates based on its subscriptions to any kind of software products.</li> <li> <p>It lists both available and used (consumed) subscriptions.</p> </li> <li> <p>It allows administrators to both subscribe and unsubscribe a system from specific subscriptions.</p> </li> </ul>"},{"location":"redhat/subscription/#check-subscription","title":"Check subscription","text":"<pre><code>subscription-manager list\n</code></pre>"},{"location":"zsh/alias/","title":"Alias","text":""},{"location":"zsh/alias/#kubectl","title":"kubectl","text":""},{"location":"zsh/alias/#get-all-contexts","title":"Get all contexts","text":"<pre><code>alias get-context=\"kubectl config get-contexts\"\n</code></pre>"},{"location":"zsh/alias/#use-a-specific-context","title":"Use a specific context","text":"<pre><code>alias context-tt=\"kubectl config use-context arn:aws:eks:&lt;region&gt;:&lt;account&gt;:cluster/&lt;name cluster&gt;\"\n</code></pre>"},{"location":"zsh/alias/#open-idea-folder-on-mac","title":"Open idea folder on MAC","text":"<pre><code>alias idea=\u2019open -a \u201c`ls -dt /Applications/IntelliJ\\ IDEA*|head -1`\u201c\u2019\n</code></pre>"}]}